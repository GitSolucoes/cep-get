<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Buscar Cards por CEP</title>
    <script src="https://unpkg.com/htmx.org@1.9.4"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 flex flex-col items-center justify-center min-h-screen p-4">
    <img src="/static/preta_reta_azul (1).svg" alt="Logo" class="w-48 mb-6">

    <form id="cep-form" class="bg-white p-6 rounded-lg shadow-lg space-y-4">
        <label class="block text-gray-700 font-bold">Digite o CEP (ou envie arquivo):</label>
        <input type="text" name="cep" class="border p-2 rounded w-full">
    
        <input type="file" name="arquivo" accept=".txt" class="border p-2 rounded w-full">
    
        <button type="submit" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
            Buscar
        </button>

        <div id="carregando" class="hidden text-blue-500">Carregando...</div>
    </form>

    <div id="resultado" class="mt-6 w-full max-w-2xl"></div>

    <script>
document.getElementById('cep-form').addEventListener('submit', async function(e) {
    e.preventDefault();

    const formData = new FormData(this);
    const resultado = document.getElementById('resultado');
    const carregando = document.getElementById('carregando');

    carregando.classList.remove('hidden');
    resultado.innerHTML = '';

    const resp = await fetch('/buscar', { method: 'POST', body: formData });

    carregando.classList.add('hidden');

    const contentType = resp.headers.get('Content-Type');

    if (contentType.includes('application/json')) {
        const data = await resp.json();
        if (data.resultados.length === 0) {
            resultado.innerHTML = '<p class="text-gray-600">Nenhum resultado encontrado.</p>';
        } else {
            let html = '<div class="grid gap-4">';
            data.resultados.forEach(r => {
                html += `
                <div class="bg-white rounded shadow p-4 border border-gray-200">
                    <p><strong>ID:</strong> ${r.id_card}</p>
                    <p><strong>Cliente:</strong> ${r.cliente}</p>
                    <p><strong>Fase:</strong> ${r.fase}</p>
                    <p><strong>CEP:</strong> ${r.cep}</p>
                    <p><strong>Criado em:</strong> ${r.criado_em}</p>
                </div>`;
            });
            html += '</div>';
            resultado.innerHTML = html;
        }
    } else if (contentType.includes('text/plain')) {
        const blob = await resp.blob();
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'resultado.txt';
        a.click();
        resultado.innerHTML = '<p class="text-green-600">Arquivo gerado: resultado.txt</p>';
    }
});
</script>
</body>
</html>
